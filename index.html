<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Travelbrag -- the travelogue of Andrea & Brett</title>
        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
        <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
    </style>
    </head>
<body>
    <div id="map"></div>
    <script>
        var svg = '<svg xmlns="http://www.w3.org/2000/svg"  xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="32" height="52">' +
            '<mask id="pinhole">' +
            '<rect width="100%" height="100%" fill="white" />' +
            '<circle cx="16" cy="16" r="5" />' +
            '</mask>' +
            '<path d="M16 1C7.715 1 1 7.656 1 15.865 1 24.075 16 51 16 51s15-26.924 15-35.135C31 7.655 24.282 1 16 1z" ' +
            'fill="{colour}" fill-opacity="0.5" mask="url(#pinhole)" stroke="#000000" />' +
            '<circle cx="16" cy="16" r="5" fill="none" stroke-width="1" stroke="#000000" />' +
            '</svg>';

        var iconCache = {};

        function createPin(colour) {
            if (!iconCache[colour]) {
                var divIcon = L.divIcon({
                    iconSize: L.point(32, 52),
                    iconAnchor: L.point(16, 51),
                    popupAnchor: L.point(0, -35),
                    className: "vector-marker",
                    html: svg.replace("{colour}", colour)
                });
                iconCache[colour] = divIcon;
            }
            return iconCache[colour];
        }

        function createMarker(feature, latLng) {
            var icon = createPin(feature.properties["marker-color"]);
            var marker = L.marker(latLng, { icon: icon });
            var popup = "<b>" + feature.properties["city"] + "</b>";
            popup += "<br><i><small>Last visited on "
                     + feature.properties["last visit"]
                     + (feature.properties["work"] ? " for work" : "")
                     + "</i></small>";
            marker.bindPopup(popup);
            return marker;
        }

        var map = L.map('map').setView([0.0, 0.0], 2);

        L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
                maxZoom: 15,  // Technically 18, but that's more zoom than necessary.'
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        fetch("travelogue.geojson").then(r => r.json())
            .then(data => L.geoJSON(data, {pointToLayer: createMarker}).addTo(map))
            .catch(e => console.log("Booo! Something went wrong when loading GeoJSON data"));
    </script>
</body>
</html>
